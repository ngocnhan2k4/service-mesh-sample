apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: customers-resilience-test
  namespace: petclinic
spec:
  hosts:
  - customers-service
  http:
    - route:
      - destination:
          host: customers-service
          port:
            number: 80
      retries:
        attempts: 3
        perTryTimeout: 2s
        retryOn: "500"
    - fault:
      abort:
        httpStatus: 500
        percentage:
          value: 50
    